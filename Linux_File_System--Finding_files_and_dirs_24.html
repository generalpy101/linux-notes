<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Finding files and dirs</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Finding files and dirs</h1><br/><p><strong>locate</strong> command is used to search for files and directories in Linux. Since files hold an important place in linux world, locate command is very important to learn.</p><p></p><p>locate is a very old command which sometimes is not located in Ubuntu by default and can be installed using <em>sudo apt get mlocate</em>.</p><p></p><p>mlocate is new version of locate command which is generally used nowadays though locate is faster.</p><p></p><p>locate is very straightforward to use, just write locate and then write name of file or directory you are searching for.</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">locate</span> &lt;name_of_file_or_dir&gt;</pre></div></p><p></p><p><img src="images/24-1.png" alt="images/24-1.png" /></p><p><img src="images/24-2.png" alt="images/24-2.png" /></p><p>Here we can see that locate returned path to files which also contained eahorse in their path name not in file itself. This is because locate is run by default with -w or --wholename flag which returns any path whose string matched with provided string thus also returning paths which contained string as as directory name only.</p><p></p><p>We can remove this behaviour by using -b which will only return results where final name(basename) matches with query string instead of anything in path name.</p><p></p><p><img src="images/24-3.png" alt="images/24-3.png" /></p><p><img src="images/24-4.png" alt="images/24-4.png" /></p><p></p><p>locate adds * before and after the argument string implicitly thus returning those paths also where exact match is not found(like seahorse instead of eahorse).</p><p></p><p>We can remove this behaviour by adding quotation marks around string and prepending a \(backslash) to the string.</p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">locate</span> root == <span style="color:#ff9d00;font-weight:700">locate</span> *root*<br /><span style="color:#ff9d00;font-weight:700">locate</span> <span style="color:#3ad900;font-weight:400">&#39;\root&#39;</span> <span style="color:#ff9d00;font-weight:700">:</span> Will only <span style="color:#ff9d00;font-weight:700">return</span> exact matches</pre></div></p><p></p><p><img src="images/24-5.png" alt="images/24-5.png" /></p><p><img src="images/24-6.png" alt="images/24-6.png" /></p><p></p><p><strong>How locate works</strong> : Locate works by managing a database of paths. Locate has a database which contains whole system&#39;s paths and that database must be updated on a daily basis by using <em><strong>updatedb</strong></em> command as sudo. This database is used by locate to search for files. This database technique is fast but that also comes with a tradeoff that realtime paths cannot be shown, when we create or delete files , it will not be reflected in locate until database is updated.</p><p></p><p>Locate&#39;s database is stored in /var/lib/mlocate. Database stats can be seen by using -S flag with locate.</p><p><img src="images/24-7.png" alt="images/24-7.png" /></p><p></p><p>Below image shows how we have to update database when using locate and changes are made in filesystem.</p><p><img src="images/24-8.png" alt="images/24-8.png" /></p><p></p><p>locate provides a -e flag which can check if a file exists or not even if db is not updated.</p><p></p><p>We used -e to check if file exist or not without updating the db.</p><p><img src="images/24-9.png" alt="images/24-9.png" /></p><p></p><p>-i flag is used to ignore cases while searching and -r flag can be used to match using regex.</p><p></p><p><strong>which</strong> command returns the absolute path of any command present in linux world. By defualt it will only return first match but we can bypass that by using -a flag.</p><p><img src="images/24-10.png" alt="images/24-10.png" /></p><p></p><p><strong><h2>Find</h2></strong></p><p></p><p>We discovered 2 problems with locate, it searches using database, thus we have to update database frequently and second is that we dont have many options.</p><p></p><p>These problems are solved by the newer and better find command.</p><p></p><p>Find searches in realtime and has a lot of options like search by size, permissions, users, groups etc.</p><p></p><p>Syntax of find is :</p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">find</span> where_to_search search_expression_with_options</pre></div></p><p></p><p><img src="images/24-11.png" alt="images/24-11.png" /></p><p></p><p>There are many options in find command. Some of them are :-</p><p></p><p><strong>-name</strong> : Search for name. Case sensitive. Wildcards not enabled by default but can be used, try to enclose query string between quotes when using wildcards</p><p><img src="images/24-12.png" alt="images/24-12.png" /></p><p>Above find command means find in current directory where name = report.txt</p><p></p><p>-<strong>iname</strong> : Search for name but case incensitive. Wild cards can be used </p><p><img src="images/24-13.png" alt="images/24-13.png" /></p><p></p><p><strong>-delete</strong> : Used to delete items permanently which appear in find result. Dangerous, use carefully.</p><p><img src="images/24-14.png" alt="images/24-14.png" /></p><p></p><p>Note that find will give permission denied error for files and dirs it cannot access. Use sudo to bypass that.</p><p></p><p><strong>-ls</strong> : Run ls command on dirs where find is successful.</p><p><img src="images/24-15.png" alt="images/24-15.png" /></p><p></p><p><strong>-type</strong> : Finds files and dirs of a given type.</p><p>Below command finds all items of type directory. We can use type letter(those appear at very first in ls commands type and permissions) to search for corresponding files.</p><p><img src="images/24-16.png" alt="images/24-16.png" /> </p><p></p><p>Above command lists every directory present in etc which is extremely inefficient so we use <strong>-maxdepth</strong> flag followed by depth we want to search. (Depth means number of subdirectories we want to encounter).</p><p>maxdepth can also be used with other options in find.</p><p><img src="images/24-17.png" alt="images/24-17.png" /></p><p>Difference between simple find and find with maxdepth</p><p><img src="images/24-18.png" alt="images/24-18.png" /></p><p></p><p><strong>-perm</strong> : Find items with given permissions. More on permissions later.</p><p><img src="images/24-19.png" alt="images/24-19.png" /></p><p></p><p><strong>-size</strong> : Finds items with given size(more than, less than, equal to provided size).</p><p></p><p>We use + to denote greater than and - to denote less than. EG +100M is size greater than 100 MB , -100M means size less than 100M and no sign means equal to.</p><p><img src="images/24-20.png" alt="images/24-20.png" /></p><p></p><p>Here we have sizes displayed differently in ls. It is because ls denotes file sizes in units of 1024 and 100M in units of 1000s.</p><p></p><p><strong>-mtime,-ctime,-atime</strong> : Finds items acc to mtime , ctime and atime . After this option we give argument as number of days or how many 24 hrs have passed till the times of file or dir have changed. For example -mtime 0 means find will find all files which were modified in last 24 hours or today.</p><p></p><p>Fractional parts are ignored. It means if we pass 0 as argument to mtime, any file modified in last 12 will also be listed.</p><p>+ and - signs apply to this also.</p><p><img src="images/24-21.png" alt="images/24-21.png" /></p><p></p><p><strong>-mmin, -amin, -cmin</strong>  : Finds files according to mins instead of days.</p><p>Find all files that were modified in last 60 minutes.</p><p><img src="images/24-22.png" alt="images/24-22.png" /></p><p></p><p><strong>-user and -group</strong> : To find files owned or not owned by any user or group. Use -not before group or user to find not owned files.</p><p><img src="images/24-23.png" alt="images/24-23.png" /></p><p></p><p>-<strong>exec</strong> : Used to execute a command over items which were found by find command. Syntax of exec is :</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">find</span> ...expression... -exec <span style="color:#ff9d00;font-weight:700">command</span> <span style="color:#333333;font-weight:400">\;</span></pre></div></p><p>exec commands end with \;.</p><p></p><p>Here to access values returned by find we use {}.</p><p>For example to cat all files which were modified in last hour, syntax will be :</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">find</span> <span style="color:#ff9d00;font-weight:700">.</span> -type f -mmin -60 -exec <span style="color:#ff9d00;font-weight:700">cat</span> <span style="color:#ff9d00;font-weight:700">{}</span> <span style="color:#333333;font-weight:400">\;</span></pre></div></p><p></p><p><img src="images/24-24.png" alt="images/24-24.png" /></p><p></p><p><strong>-ok</strong> : Just like exec but works interactively. It asks you before executing every command.</p><p><img src="images/24-25.png" alt="images/24-25.png" /></p></div>
</body>
</html>
