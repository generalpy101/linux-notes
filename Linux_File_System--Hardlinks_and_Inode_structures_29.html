<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Hardlinks and Inode structures</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Hardlinks and Inode structures</h1><br/><p>In linux every file is associated with a special data structure known as <strong>Index Node or Inode</strong>.</p><p></p><p>Inodes contain all metadata about file such as file&#39;s permissions, owners, type, size etc.</p><p></p><p>Inodes actually store everything except file&#39;s contents and and file names. Each inode is uniquely identified by an integer known as inode number which can be viewed by <strong>ls -i</strong> command.</p><p></p><p><img src="images/29-1.png" alt="images/29-1.png" /></p><p></p><p>All contents shown by ls -l command are stored in inode.</p><p></p><p>Since file names are not stored in inodes, they are stored in directories. Directories are basically 2 column tables where first column contains file names and second column is inode number.</p><p>Directories are something like below output.</p><p><img src="images/29-2.png" alt="images/29-2.png" /></p><p></p><p>When file is accessed, the current directory is searched for file and its inode number is reffered and used further. File contents are stored somewhere else where inodes contain pointers to file contents.</p><p></p><p>The association between the file strucuture and file name is called  <strong>hard link</strong>. The third column in output of ls -li is number of hardlinks to a file.</p><p></p><p>Stat also gives number of hard links.</p><p></p><p><img src="images/29-3.png" alt="images/29-3.png" /></p><p></p><p>We can create new hardlink by <strong>ln</strong> command which stand for link. Simple syntax of ln is :</p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">ln</span> existing_name new_name</pre></div></p><p></p><p><img src="images/29-4.png" alt="images/29-4.png" /></p><p></p><p><img src="images/29-5.png" alt="images/29-5.png" /></p><p></p><p>Here both err.txt and new_name.txt are same. If we change one second one will also change as inodes are same.</p><p></p><p>Hardlinks can also be created in different dirs.</p><p></p><p>If we remove a file using rm, only the specified hard link(file name) is deleted and hardlink count is decremented by 1. If inode hardlink count is 0 then only inode is freed for further use.</p><p><img src="images/29-6.png" alt="images/29-6.png" /></p><p></p><p>We removed err.txt but new_name.txt is still there with inode count of 1. </p><p></p><p>We can use find command to find all hardlinks using <strong>-inum</strong> flag and passing it inode number.</p><p><img src="images/29-7.png" alt="images/29-7.png" /></p><p></p><p>We cannot create hardliinks to directories or files in a different partition as hard links cannot cross partition boundaries.</p><p></p><p><img src="images/29-8.png" alt="images/29-8.png" /></p><p></p><p>We can see that we cannot create hard links but there are 147 hard links already present. These are , . directory which is reference to the directory itself, and all of the subdirectories inside the directory which contain link to parent directory using <strong>..</strong>  .</p><p></p><p><img src="images/29-9.png" alt="images/29-9.png" /></p><p>We can notice .. inside vim has same inode number as etc.</p><p></p><p>We can find files using number of links with find command with  <strong>-links</strong> flag.</p><p></p><p>Below command finds all files with more than 2 links.</p><p><img src="images/29-10.png" alt="images/29-10.png" /> </p><p></p><p><h2>Softlinks or Symlinks </h2></p><p></p><p>Hardlinks are links between file names and inode structures but softlinks are special files which point towards a file or directory.</p><p></p><p>If we delete a hardlink, remaining files point to same inode but if we delete file where symlink is poiniting to, the symlink becomes useless or broken.</p><p></p><p>To create a symlink we use ln command with <strong>-s</strong> flag.</p><p></p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">ln</span> -s existing_file symlink_name</pre></div></p><p></p><p><img src="images/29-11.png" alt="images/29-11.png" /></p><p></p><p>We can see pswd is colored differently and an arrow is created which is pointing to /etc/passwd.</p><p></p><p></p><p>We created a new file named new.txt and created a symlink and hardlink.</p><p><img src="images/29-12.png" alt="images/29-12.png" /></p><p></p><p>We moved our file to a different directory. Symlink is broken but hardlink is still there.</p><p><img src="images/29-13.png" alt="images/29-13.png" /></p><p>A symlink can also pass partitions.</p><p></p></div>
</body>
</html>
