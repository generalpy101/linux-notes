<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Troubleshooting ssh</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Troubleshooting ssh</h1><br/><p>First step to configure ssh is to check if server is accessible or not, i.e ping the server(or use other methods if ping is blocked).</p><p></p><p><img src="images/65-1.png" alt="images/65-1.png" /></p><p></p><p>If server is up and running, check if port 22 is accessible and is running ssh(using telnet or ssh). Sometimes ssh is also running on different ports so we can run a nmap scan to get results.</p><p><img src="images/65-2.png" alt="images/65-2.png" /></p><p><img src="images/65-3.png" alt="images/65-3.png" /></p><p></p><p>nmap and telnet scans confirm that port 22 is open and is of ssh.</p><p></p><p><img src="images/65-4.png" alt="images/65-4.png" /></p><p></p><p>If you get error like above, then some server properties like ip address, mac address etc have changed since the last time you logged in hence the RSA key has changed. So we first remove the key from the known_hosts file which resides in a hidden directory in user&#39;s home directory.(full path = /home/user/.ssh/known_hosts). We can then again connect to the server, this time the prompt for saving RSA fingerprint will appear.</p><p></p><p>Sometimes firewall blocks service like ssh.</p><p></p><p>The linux firewall is called netfilters iptables. To check firewall policies, we can use command :</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> iptables -vnL</pre></div></p><p></p><p><img src="images/65-5.png" alt="images/65-5.png" /></p><p></p><p>Check that policy is set to Accept and there are no rules to drop packets.</p><p></p><p>There is also another firewall in ubuntu which is know as ufw(uncomplicated firewall) which is disabled by default and can be used to set firewall rules easily.</p><p><img src="images/65-6.png" alt="images/65-6.png" /></p><p></p><p>We can see all available application profiles for firewall by using :</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> ufw app list</pre></div></p><p></p><p>We can then allow a application(like ssh in our case) by using :</p><p><div class="codebox"><pre><span style="color:#ff9d00;font-weight:700">sudo</span> ufw allow <span style="color:#ff9d00;font-weight:700">ssh</span></pre></div></p><p></p><p><img src="images/65-7.png" alt="images/65-7.png" /></p><p></p><p>If there is still a problem, we can run ssh in verbose mode using -v flag. Multiple v increase verbosity.</p><p><img src="images/65-8.png" alt="images/65-8.png" /></p><p></p><p>We can also check server logs for the problems. On ubuntu logs are stored in /var/log/auth.log and on centos /var/log/secure</p><p></p><p><img src="images/65-9.png" alt="images/65-9.png" /></p></div>
</body>
</html>
